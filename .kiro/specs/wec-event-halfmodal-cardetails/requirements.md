# Requirements Document

## Project Description (Input)
Route.Wec.Season_.Event_ の下部に表示しているハーフモーダルの内容を改修します。現在のLeaderboard表示をやめて、右サイドバーに表示しているCarDetailsを表示するように変更したいです。

## Context / 背景
- 対象画面: `Route.Wec.Season_.Event_`
- 既存仕様: 画面下部のハーフモーダルに `Leaderboard` を表示。右サイドバーには `CarDetails` を表示。
- 変更方針: ハーフモーダルの表示コンテンツを `Leaderboard` から `CarDetails` に置換し、サイドバーと同等の内容・挙動を提供する。

## Goals / 目的
- 画面下部ハーフモーダルに `CarDetails` を表示する。
- 右サイドバーの `CarDetails` と内容・データ整合性を保つ（同一データソース/ストアを参照）。
- 選択中の車両（Car）に応じて両方の `CarDetails` が同期して更新される。

## Non-Goals / 非対象
- `CarDetails` の情報構造（フィールド追加・削除）の根本的変更。
- イベントページ以外の画面改修。
- Leaderboard機能自体の削除（今回は非表示化／置換のみ。削除は別タスク）。

## Scope / 範囲
- ハーフモーダル内のコンテンツを `CarDetails` に差し替え。
- 右サイドバーと同一または共有化した `CarDetails` コンポーネントの再利用。
- 選択車両ステート（例: `selectedCarId`）との双方向同期（サイドバー・地図・リスト等の選択起点を含む）。
- ローディング/エラー/空状態のUI（ハーフモーダル版）。
- レスポンシブ対応（モバイル/タブレット/デスクトップ）と折りたたみ挙動。

## Out of Scope / 範囲外
- サイドバー `CarDetails` の廃止。
- リアルタイム更新頻度・APIスキーマの変更。
- ハーフモーダルのキーボードによる開閉・フォーカス遷移可能操作の実装。


## User Stories / ユースケース
- ユーザーとして、イベント画面で車両を選択したとき、ハーフモーダルに選択車両の `CarDetails` が表示される。
- ユーザーとして、右サイドバーで車両を切り替えたとき、ハーフモーダルの `CarDetails` も同じ内容に更新される。
- ユーザーとして、初回表示で選択車両が無い場合、1位の車両を表示する。
- ユーザーとして、ネットワークエラー時には再試行可能なメッセージと最小限の空状態が表示される。

## Assumptions / 前提
- `CarDetails` は右サイドバーで使用中の実装をベースに再利用可能。
- 選択車両は Model.selectedCar で一元管理。
- ハーフモーダルの開閉は既存の下部UIコンポーネントを踏襲（トリガ・スワイプ・エスケープ等）。

## Open Questions / 未確定事項
1. デフォルト表示の車両は何を基準に選択するか（先頭/最新選択/URLクエリなど）。
  -> その時点での1位の車両を表示する
2. サイドバーとハーフモーダルの重複表示をレスポンシブで最適化するか（小画面でどちらかを自動非表示等）。
  -> 将来的にはサイドバーでの表示を廃止予定なので、現時時点で重複表示を受けての最適化は不要
3. `CarDetails` のサイドバー版とハーフモーダル版でUI差分（密度、折りたたみセクション）を設けるか。
  -> 前述の通り、サイドバーでの表示は廃止予定なので、サイドバー版のUI表示は考慮しなくて良い

## Data & API / データ要件
- 右サイドバーと同一のデータ取得経路・型定義（型の単一ソース化）。
- 欠損フィールドへのフォールバック表記（"N/A" 等）をハーフモーダルでも統一。

## Error & Empty States / 例外系
- データ空: プレースホルダー表示と案内文。

## Acceptance Criteria / 受け入れ条件
1. ハーフモーダルに `CarDetails` が表示されること。
2. 右サイドバーの選択変更がハーフモーダルへ即時反映されること。
3. 初回表示・切替時にローディング/エラー/空状態が正しく表示されること。

## Test Plan / テスト計画
- 単体: `CarDetails` 表示ロジック、ステート同期、フォールバック。

## Risks / リスクと緩和
- 状態不整合 → 単一ソースの選択ステートに統一。
- デザイン差異 → デザイン合意とバリアント設計。

## Dependencies / 依存
- `CarDetails` コンポーネント、選択ステート管理、既存ハーフモーダルUI、APIクライアント。

---
本要件はレビュー承認後に設計フェーズ（/kiro-spec-design）へ進みます。
